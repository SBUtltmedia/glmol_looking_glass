<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
  <style>
    body {
      margin: 0;
    }

    canvas {
      width: 100%;
      height: 100%;
    }

    ;
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/109/three.min.js" charset="utf-8"></script>
  <script src="js/holoplay.min.js" charset="utf-8"></script>
  <script src="js/GLmol.js" charset="utf-8"></script>
  <script src="js/leap-0.6.4.js"></script>
  <script src="js/roll-pitch-yaw.js"></script>

  <script>
    var scene, camera, renderer, holoplay, pivot;
    var magic=true;
    //Lighting elements
    var directionalLight;
    var ambientLight;
    var globalMol;
    //Scene objects
    var cubeGeometry;
    var cubeMaterial;
    var cubes;
    var SPEED = .01;
    window.addEventListener('resize', function() {
      var width = window.innerWidth;
      var height = window.innerHeight;

      renderer.setSize(width, height);

      camera.aspect = width / height;
      camera.updateProjectionMatrix();
    });

    //Initialize our variables
    function init() {
      scene = new THREE.Scene();
      pivot = new THREE.Group();

      camera = new THREE.PerspectiveCamera(13.5, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, -0.7, 20);

      renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);
      renderer.render(scene, camera);
    if(magic){
       holoplay = new HoloPlay(scene, camera, renderer);
}
      directionalLight = new THREE.DirectionalLight(0xFFFFFF, 1);
      directionalLight.position.set(0, 1, 2);
      scene.add(directionalLight);

      ambientLight = new THREE.AmbientLight(0xFFFFFF, 0.4);
      scene.add(ambientLight);

      var glmol = new GLmol('glmol01', true);
      glmol.returnModelGroup().then(function(mol) {
        globalMol = mol;
        globalMol.scale.set(0.05, 0.05, 0.05)
        console.log(globalMol);

        scene.add(pivot);
        pivot.add(globalMol)
      })
    }


    //Render the scene
    function draw() {
      // if (pivot) {
        pivot.rotation.y -= SPEED;
        if (!paused) {
          pivot.rotation.y = hand.yaw();
          pivot.rotation.x = hand.pitch();
          pivot.rotation.z = hand.roll();
          // globalMol.position.set(normalize(hand.palmPosition[0], -5, 5), normalize(hand.palmPosition[1], -5, 5), normalize(hand.palmPosition[2], -20, 0));
          // console.log(globalMol.position);
        // }
      }
      if(magic){
              holoplay.render();
      }
      else{renderer.render(scene, camera);}

    }

    function normalize(val, max, min) {
      return (val - min) / (max - min);
    }

    //Game loop
    function RunApp() {

      requestAnimationFrame(RunApp);
      draw();
    }
    window.addEventListener('load', (event) => {
      init();
      RunApp();

    });
    //     window.onload = function() {
    //
    //   var renderer = new THREE.WebGLRenderer();
    //   renderer.setSize( 800, 600 );
    //   document.body.appendChild( renderer.domElement );
    //
    //   var scene = new THREE.Scene();
    //
    //   var camera = new THREE.PerspectiveCamera(
    //     35,			// Field of view
    //     800 / 600,		// Aspect ratio
    //     0.1,			// Near plane
    //     10000			// Far plane
    //   );
    //   // camera.position.set( -15, 10, 10 );
    //   camera.position.set(0,0,20);
    //   camera.lookAt(scene.position);
    //
    //   var geometry = new THREE.BoxGeometry( 5, 5, 5 );
    //   var material = new THREE.MeshLambertMaterial( { color: 0xFF0000 } );
    //   var mesh = new THREE.Mesh( geometry, material );
    //   //scene.add( mesh );
    //
    //   var light = new THREE.PointLight( 0xFFFF00 );
    //   light.position.set( 10, 0, 10 );
    //   scene.add(light);
    //   var glmol= new GLmol('glmol01', true);
    //
    //     glmol.returnModelGroup().then(function(mol) {
    //       scene.add(mol);
    //       console.log(mol)
    //     })
    //
    //   renderer.setClearColor( 0xdddddd, 1);
    //   renderer.render( scene, camera );
    //
    // };
  </script>
</head>

<body>
  <div id="pause"></div>
  <div id="out"></div>

</body>

</html>
